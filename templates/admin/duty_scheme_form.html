{% extends "base.html" %}

{% block title %}{{ title }} - PLS TRAVELS{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Gamified Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-primary text-white">
                <div class="card-body text-center py-4">
                    <h2><i class="fas fa-trophy me-3"></i>üéØ Salary Method Setup Wizard</h2>
                    <p class="mb-0">Create the perfect driver compensation plan step by step</p>
                    <!-- Progress Bar -->
                    <div class="progress mt-3" style="height: 8px; background: rgba(255,255,255,0.2);">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 25%" id="setup-progress"></div>
                    </div>
                    <small class="mt-2 d-block">Step <span id="current-step">1</span> of 4 - Basic Configuration</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-10">
            <form method="POST" id="salary-wizard">
                {{ form.hidden_tag() }}
                
                <!-- Step 1: Basic Setup -->
                <div class="wizard-step active" id="step-1">
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">
                            <h5><i class="fas fa-rocket me-2"></i>üöÄ Step 1: Basic Setup</h5>
                            <small>Let's start with the fundamentals of your salary scheme!</small>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label class="form-label"><i class="fas fa-tag me-2"></i>üè∑Ô∏è Scheme Name</label>
                                    {{ form.name(class="form-control form-control-lg", placeholder="e.g., High Performance Driver Plan") }}
                                    {% if form.name.errors %}
                                        <div class="text-danger">
                                            {% for error in form.name.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Choose a memorable name that drivers will recognize</div>
                                </div>
                                
                                <div class="col-md-6">
                                    <label class="form-label"><i class="fas fa-building me-2"></i>üè¢ Branch Application</label>
                                    {{ form.branch_id(class="form-select form-control-lg") }}
                                    <div class="form-text">Select 'Global' to apply across all branches</div>
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label class="form-label"><i class="fas fa-calendar-check me-2"></i>üìÖ Start Date</label>
                                    {{ form.effective_from(class="form-control") }}
                                    <div class="form-text">When this scheme becomes active</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label"><i class="fas fa-calendar-times me-2"></i>üìÖ End Date (Optional)</label>
                                    {{ form.effective_until(class="form-control") }}
                                    <div class="form-text">Leave empty for permanent scheme</div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label"><i class="fas fa-shield-alt me-2"></i>üõ°Ô∏è Minimum Guarantee</label>
                                    {{ form.bmg_amount(class="form-control", placeholder="0") }}
                                    <div class="form-text">Safety net - minimum earnings guaranteed per day</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label"><i class="fas fa-clock me-2"></i>‚è∞ Payout Frequency</label>
                                    {{ form.payout_frequency(class="form-select") }}
                                    <div class="form-text">How often drivers receive payments</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Salary Method Selection -->
                <div class="wizard-step" id="step-2" style="display: none;">
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5><i class="fas fa-bullseye me-2"></i>üéØ Step 2: Choose Salary Method</h5>
                            <small>Select the perfect compensation strategy for your drivers!</small>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <label class="form-label text-center d-block mb-4">
                                        <h6><i class="fas fa-gem me-2"></i>üíé Select Your Preferred Salary Method</h6>
                                    </label>
                                    {{ form.scheme_type(class="form-select form-control-lg text-center", id="scheme-type") }}
                                    <div class="form-text text-center mt-3">Each method has different benefits - choose what works best for your drivers!</div>
                                </div>
                            </div>
                            
                            <!-- Method Preview Cards -->
                            <div class="row mt-4" id="method-preview">
                                <div class="col-12">
                                    <div class="alert alert-info text-center">
                                        <i class="fas fa-lightbulb me-2"></i>
                                        Select a salary method above to see its configuration options
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Step 3: Salary Configuration -->
                <div class="wizard-step" id="step-3" style="display: none;">
                    <div class="card mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h5><i class="fas fa-cogs me-2"></i>‚öôÔ∏è Step 3: Configure Your Salary Method</h5>
                            <small>Fine-tune the parameters for maximum driver satisfaction!</small>
                        </div>
                        <div class="card-body">
                            
                            <!-- Daily Payout Configuration -->
                            <div id="daily-payout-fields" class="scheme-fields" style="display: none;">
                                <div class="alert alert-success">
                                    <h6><i class="fas fa-calendar-day me-2"></i>üåÖ Daily Payout Method</h6>
                                    <p>Drivers get paid immediately after each duty completion - perfect for cash flow!</p>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-coins me-2"></i>üí∞ Daily Base Amount</label>
                                        {{ form.daily_base_amount(class="form-control form-control-lg", placeholder="800") }}
                                        <div class="form-text">Fixed amount paid every day</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-percentage me-2"></i>üìà Daily Incentive (%)</label>
                                        {{ form.daily_incentive_percent(class="form-control form-control-lg", placeholder="15") }}
                                        <div class="form-text">Percentage of daily revenue as bonus</div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <strong>üí° Example:</strong> Base ‚Çπ800 + 15% incentive<br>
                                    For ‚Çπ3000 daily revenue: ‚Çπ800 + (‚Çπ3000 √ó 15%) = <strong>‚Çπ1,250 paid immediately!</strong>
                                </div>
                            </div>

                            <!-- Monthly Payout Configuration -->
                            <div id="monthly-payout-fields" class="scheme-fields" style="display: none;">
                                <div class="alert alert-primary">
                                    <h6><i class="fas fa-calendar-alt me-2"></i>üìÖ Monthly Payout Method</h6>
                                    <p>Accumulated earnings paid at month end - great for budgeting and bigger payments!</p>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-money-bill me-2"></i>üíµ Monthly Base Salary</label>
                                        {{ form.monthly_base_salary(class="form-control form-control-lg", placeholder="25000") }}
                                        <div class="form-text">Monthly base salary (pro-rated daily)</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-chart-line me-2"></i>üìä Monthly Incentive (%)</label>
                                        {{ form.monthly_incentive_percent(class="form-control form-control-lg", placeholder="12") }}
                                        <div class="form-text">Percentage of monthly revenue as bonus</div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <strong>üí° Example:</strong> Base ‚Çπ25,000/month + 12% incentive<br>
                                    For ‚Çπ90,000 monthly revenue: ‚Çπ25,000 + (‚Çπ90,000 √ó 12%) = <strong>‚Çπ35,800 at month end!</strong>
                                </div>
                            </div>

                            <!-- Performance Based Configuration -->
                            <div id="performance-based-fields" class="scheme-fields" style="display: none;">
                                <div class="alert alert-success">
                                    <h6><i class="fas fa-trophy me-2"></i>üèÜ Performance Based Method</h6>
                                    <p>Reward high performers with extra bonuses for hitting targets!</p>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-bullseye me-2"></i>üéØ Target Trips Daily</label>
                                        {{ form.target_trips_daily(class="form-control form-control-lg", placeholder="12") }}
                                        <div class="form-text">Daily trip target for bonus eligibility</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-dollar-sign me-2"></i>üí∞ Target Revenue Daily</label>
                                        {{ form.target_revenue_daily(class="form-control form-control-lg", placeholder="3000") }}
                                        <div class="form-text">Daily revenue target for bonus</div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-gift me-2"></i>üéÅ Bonus Per Extra Trip</label>
                                        {{ form.bonus_per_extra_trip(class="form-control form-control-lg", placeholder="50") }}
                                        <div class="form-text">Extra bonus for trips above target</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-star me-2"></i>‚≠ê Target Achievement Bonus</label>
                                        {{ form.bonus_target_achievement(class="form-control form-control-lg", placeholder="200") }}
                                        <div class="form-text">Bonus when both targets are hit</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hybrid Commission Configuration -->
                            <div id="hybrid-commission-fields" class="scheme-fields" style="display: none;">
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-balance-scale me-2"></i>‚öñÔ∏è Hybrid Commission Method</h6>
                                    <p>Best of both worlds - guaranteed base pay plus performance incentives!</p>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-home me-2"></i>üè† Base Amount</label>
                                        {{ form.base_amount(class="form-control form-control-lg", placeholder="600") }}
                                        <div class="form-text">Guaranteed base amount per day</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-rocket me-2"></i>üöÄ Incentive Percentage</label>
                                        {{ form.incentive_percent(class="form-control form-control-lg", placeholder="18") }}
                                        <div class="form-text">Commission percentage on revenue</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Revenue Sharing Configuration -->
                            <div id="revenue-sharing-fields" class="scheme-fields" style="display: none;">
                                <div class="alert alert-warning">
                                    <h6><i class="fas fa-handshake me-2"></i>ü§ù Revenue Sharing Method</h6>
                                    <p>Share the success! Drivers earn a percentage of what they generate!</p>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-chart-pie me-2"></i>ü•ß Revenue Share (%)</label>
                                        {{ form.revenue_share_percent(class="form-control form-control-lg", placeholder="65") }}
                                        <div class="form-text">Driver's share of total revenue</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-minus-circle me-2"></i>‚ûñ Company Expense Deduction</label>
                                        {{ form.company_expense_deduction(class="form-control form-control-lg", placeholder="200") }}
                                        <div class="form-text">Daily company expenses to deduct</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Fixed Salary Configuration -->
                            <div id="fixed-salary-fields" class="scheme-fields" style="display: none;">
                                <div class="alert alert-secondary">
                                    <h6><i class="fas fa-lock me-2"></i>üîí Fixed Salary Method</h6>
                                    <p>Predictable and stable - same amount every month regardless of performance!</p>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-calendar me-2"></i>üìÖ Fixed Monthly Salary</label>
                                        {{ form.fixed_monthly_salary(class="form-control form-control-lg", placeholder="28000") }}
                                        <div class="form-text">Fixed amount paid monthly</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-plus me-2"></i>‚ûï Monthly Allowances</label>
                                        {{ form.allowances(class="form-control form-control-lg", placeholder="2000") }}
                                        <div class="form-text">Additional allowances (fuel, maintenance)</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Piece Rate Configuration -->
                            <div id="piece-rate-fields" class="scheme-fields" style="display: none;">
                                <div class="alert alert-success">
                                    <h6><i class="fas fa-route me-2"></i>üõ£Ô∏è Piece Rate Method</h6>
                                    <p>Pay per trip - the more trips completed, the more money earned!</p>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-car me-2"></i>üöó Amount Per Trip</label>
                                        {{ form.per_trip_amount(class="form-control form-control-lg", placeholder="120") }}
                                        <div class="form-text">Fixed amount earned per completed trip</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Slab Incentive Configuration -->
                            <div id="slab-incentive-fields" class="scheme-fields" style="display: none;">
                                <div class="alert alert-danger">
                                    <h6><i class="fas fa-layer-group me-2"></i>üìä Slab Incentive Method</h6>
                                    <p>Progressive earnings - higher revenue means higher commission rates!</p>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label class="form-label">ü•â Slab 1 Max Revenue</label>
                                        {{ form.slab1_max(class="form-control", placeholder="1500") }}
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">ü•â Slab 1 Percentage</label>
                                        {{ form.slab1_percent(class="form-control", placeholder="25") }}
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label class="form-label">ü•à Slab 2 Max Revenue</label>
                                        {{ form.slab2_max(class="form-control", placeholder="3500") }}
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">ü•à Slab 2 Percentage</label>
                                        {{ form.slab2_percent(class="form-control", placeholder="35") }}
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label class="form-label">ü•á Slab 3+ Percentage</label>
                                        {{ form.slab3_percent(class="form-control", placeholder="45") }}
                                    </div>
                                </div>
                            </div>

                            <!-- Custom Formula Configuration -->
                            <div id="custom-formula-fields" class="scheme-fields" style="display: none;">
                                <div class="alert alert-dark">
                                    <h6><i class="fas fa-code me-2"></i>üë®‚Äçüíª Custom Formula Method</h6>
                                    <p>For advanced users - create your own calculation formula!</p>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-12">
                                        <label class="form-label"><i class="fas fa-calculator me-2"></i>üßÆ Custom Formula</label>
                                        {{ form.calculation_formula(class="form-control", rows="4", placeholder="(uber_collected + cash_on_hand - toll - advance) * 0.75") }}
                                        <div class="form-text">
                                            <strong>Available Variables:</strong> uber_trips, uber_collected, operator_out, cng_average, toll, qr_payment, company_pay, advance, cash_on_hand, pass_amount, insurance, start_cng, end_cng<br>
                                            <strong>Functions:</strong> max(), min(), abs(), round(), math functions
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Advanced Options -->
                <div class="wizard-step" id="step-4" style="display: none;">
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white">
                            <h5><i class="fas fa-star me-2"></i>‚≠ê Step 4: Advanced Options</h5>
                            <small>Add extra bonuses and deductions to fine-tune your salary plan!</small>
                        </div>
                        <div class="card-body">
                            <!-- Bonus Configuration -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h6><i class="fas fa-gift me-2"></i>üéÅ Performance Bonuses</h6>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label"><i class="fas fa-sun me-2"></i>üåÖ Weekend Bonus (%)</label>
                                    {{ form.weekend_bonus_percent(class="form-control", placeholder="10") }}
                                    <div class="form-text">Extra bonus for weekend duties</div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label"><i class="fas fa-clock me-2"></i>‚è∞ Overtime Multiplier</label>
                                    {{ form.overtime_rate_multiplier(class="form-control", placeholder="1.5") }}
                                    <div class="form-text">Rate multiplier for overtime hours</div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label"><i class="fas fa-calendar-star me-2"></i>üéä Holiday Bonus (%)</label>
                                    {{ form.holiday_bonus_percent(class="form-control", placeholder="25") }}
                                    <div class="form-text">Special holiday bonus percentage</div>
                                </div>
                            </div>

                            <!-- Deduction Configuration -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h6><i class="fas fa-minus-circle me-2"></i>‚ûñ Deductions</h6>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label"><i class="fas fa-gas-pump me-2"></i>‚õΩ Fuel Deduction (%)</label>
                                    {{ form.fuel_deduction_percent(class="form-control", placeholder="8") }}
                                    <div class="form-text">Percentage deducted for fuel</div>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label"><i class="fas fa-tools me-2"></i>üîß Maintenance Deduction</label>
                                    {{ form.maintenance_deduction(class="form-control", placeholder="100") }}
                                    <div class="form-text">Fixed daily maintenance cost</div>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label"><i class="fas fa-shield-alt me-2"></i>üõ°Ô∏è Insurance Deduction</label>
                                    {{ form.insurance_deduction(class="form-control", placeholder="50") }}
                                    <div class="form-text">Daily insurance cost</div>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label"><i class="fas fa-ellipsis-h me-2"></i>üîπ Other Deductions</label>
                                    {{ form.other_deductions(class="form-control", placeholder="25") }}
                                    <div class="form-text">Miscellaneous deductions</div>
                                </div>
                            </div>

                            <div class="alert alert-success text-center">
                                <i class="fas fa-check-circle me-2"></i>
                                <strong>Great work!</strong> Your comprehensive salary scheme is ready to be saved!
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="row mb-4">
                    <div class="col-12 d-flex justify-content-between">
                        <button type="button" class="btn btn-outline-secondary" id="prev-btn" style="display: none;">
                            <i class="fas fa-arrow-left me-2"></i>Previous
                        </button>
                        <button type="button" class="btn btn-primary" id="next-btn">
                            Next<i class="fas fa-arrow-right ms-2"></i>
                        </button>
                        <button type="submit" class="btn btn-success btn-lg" id="submit-btn" style="display: none;">
                            <i class="fas fa-rocket me-2"></i>üöÄ Launch Salary Scheme!
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gamified Wizard Variables
    let currentStep = 1;
    const totalSteps = 4;
    const progressBar = document.getElementById('setup-progress');
    const currentStepSpan = document.getElementById('current-step');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const submitBtn = document.getElementById('submit-btn');
    const schemeTypeSelect = document.getElementById('scheme-type');
    const schemeFields = document.querySelectorAll('.scheme-fields');
    
    // Step names for progress tracking
    const stepNames = {
        1: 'Basic Configuration',
        2: 'Salary Method Selection', 
        3: 'Method Configuration',
        4: 'Advanced Options'
    };
    
    // Update progress bar and step indicator
    function updateProgress() {
        const progressPercent = (currentStep / totalSteps) * 100;
        progressBar.style.width = progressPercent + '%';
        currentStepSpan.textContent = currentStep;
        document.querySelector('.progress').nextElementSibling.innerHTML = 
            `Step <span id="current-step">${currentStep}</span> of ${totalSteps} - ${stepNames[currentStep]}`;
    }
    
    // Show/hide wizard steps
    function showStep(step) {
        document.querySelectorAll('.wizard-step').forEach(stepDiv => {
            stepDiv.style.display = 'none';
        });
        
        const targetStep = document.getElementById(`step-${step}`);
        if (targetStep) {
            targetStep.style.display = 'block';
        }
        
        // Update navigation buttons
        prevBtn.style.display = step > 1 ? 'block' : 'none';
        nextBtn.style.display = step < totalSteps ? 'block' : 'none';
        submitBtn.style.display = step === totalSteps ? 'block' : 'none';
        
        updateProgress();
        
        // Add some animation
        if (targetStep) {
            targetStep.style.opacity = '0';
            setTimeout(() => {
                targetStep.style.transition = 'opacity 0.3s ease-in-out';
                targetStep.style.opacity = '1';
            }, 50);
        }
    }
    
    // Handle salary method selection and show appropriate fields
    function showSchemeFields() {
        // Hide all scheme fields first
        schemeFields.forEach(field => field.style.display = 'none');
        
        const selectedType = schemeTypeSelect.value;
        
        // Complete mapping for all 9 salary methods
        const fieldMapping = {
            'daily_payout': 'daily-payout-fields',
            'monthly_payout': 'monthly-payout-fields', 
            'performance_based': 'performance-based-fields',
            'hybrid_commission': 'hybrid-commission-fields',
            'revenue_sharing': 'revenue-sharing-fields',
            'fixed_salary': 'fixed-salary-fields',
            'piece_rate': 'piece-rate-fields',
            'slab_incentive': 'slab-incentive-fields',
            'custom_formula': 'custom-formula-fields'
        };
        
        // Show method preview
        const methodPreview = document.getElementById('method-preview');
        if (selectedType && fieldMapping[selectedType]) {
            const targetField = document.getElementById(fieldMapping[selectedType]);
            if (targetField) {
                targetField.style.display = 'block';
                
                // Show preview in step 2
                const methodName = selectedType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                methodPreview.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-success text-center">
                            <i class="fas fa-check-circle me-2"></i>
                            <strong>Selected: ${methodName}</strong><br>
                            <small>Configuration options will appear in the next step!</small>
                        </div>
                    </div>
                `;
            }
        } else {
            methodPreview.innerHTML = `
                <div class="col-12">
                    <div class="alert alert-info text-center">
                        <i class="fas fa-lightbulb me-2"></i>
                        Select a salary method above to see its configuration options
                    </div>
                </div>
            `;
        }
    }
    
    // Navigation event handlers
    nextBtn.addEventListener('click', function() {
        if (currentStep < totalSteps) {
            currentStep++;
            showStep(currentStep);
        }
    });
    
    prevBtn.addEventListener('click', function() {
        if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
        }
    });
    
    // Handle scheme type changes
    schemeTypeSelect.addEventListener('change', showSchemeFields);
    
    // Form validation before proceeding
    function validateCurrentStep() {
        const currentStepDiv = document.getElementById(`step-${currentStep}`);
        const requiredFields = currentStepDiv.querySelectorAll('input[required], select[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        return isValid;
    }
    
    // Add some gamification effects
    function celebrateStep() {
        const celebration = document.createElement('div');
        celebration.innerHTML = 'üéâ';
        celebration.style.position = 'fixed';
        celebration.style.top = '50%';
        celebration.style.left = '50%';
        celebration.style.fontSize = '3rem';
        celebration.style.zIndex = '9999';
        celebration.style.animation = 'bounce 0.5s ease-in-out';
        document.body.appendChild(celebration);
        
        setTimeout(() => {
            document.body.removeChild(celebration);
        }, 1000);
    }
    
    // Initialize wizard
    showStep(1);
    showSchemeFields();
    
    // Add some CSS for animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) translateX(-50%); }
            40% { transform: translateY(-30px) translateX(-50%); }
            60% { transform: translateY(-15px) translateX(-50%); }
        }
        .wizard-step {
            min-height: 400px;
        }
        .form-control:focus, .form-select:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, 0.25);
        }
        .btn:hover {
            transform: translateY(-2px);
            transition: all 0.2s ease-in-out;
        }
    `;
    document.head.appendChild(style);
    
    // Add celebration when reaching final step
    const originalShowStep = showStep;
    showStep = function(step) {
        originalShowStep(step);
        if (step === totalSteps) {
            setTimeout(celebrateStep, 300);
        }
    };
});
</script>
{% endblock %}
